<?php
/*********************************************************************************
 * The content of this file is subject to the EMAIL Maker license.
 * ("License"); You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is IT-Solutions4You s.r.o.
 * Portions created by IT-Solutions4You s.r.o. are Copyright(C) IT-Solutions4You s.r.o.
 * All Rights Reserved.
 ********************************************************************************/
//error_reporting(63);

$memory_limit = substr(ini_get("memory_limit"), 0,-1);
if($memory_limit<256){
  ini_set("memory_limit","256M");
}

global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;

$x0b="\141\x72\x72\x61\x79\137\x6b\x65\x79\163"; $x0c="a\x72\x72\x61\x79\137\160us\150"; $x0d="a\x72r\x61\171_\155\145r\147e"; $x0e="\x61\162r\x61\171\x5fsu\x6d"; $x0f="\x63a\154\x6c\x5fu\x73\145\x72\x5f\146u\156c\x5f\x61r\x72a\x79"; $x10="\143\157\165n\164"; $x11="\144ate"; $x12="\x65\x78p\x6cod\x65"; $x13="\146i\x6ce\137\145\170\151\x73\164s"; $x14="\147l\x6f\142"; $x15="\150\164\x6d\x6c\x5f\145\156t\151\x74y\x5f\x64\x65\143\157de"; $x16="\151c\157\156\x76"; $x17="\x69\155\160l\157d\145"; $x18="i\x6e\x5f\141\162\162\x61\171"; $x19="\151\163_\156\x75m\145\162\x69c"; $x1a="i\x73\137\x6fb\152\145\x63\164"; $x1b="md\x35"; $x1c="n\x6c2\x62\x72"; $x1d="n\x75\x6d\x62\145\162\137\x66\x6f\x72\x6d\x61\164"; $x1e="\x70\x72e\x67\x5fma\164\143\150\137\141\154\154"; $x1f="\x72\157\x75\x6e\144"; $x20="\x72\164rim"; $x21="s\164r_\x72e\160\154\141\x63\x65"; $x22="\x73t\x72\137\x69r\145p\x6c\x61c\x65"; $x23="\163\x74\x72\154e\156"; $x24="str\164ol\x6fwe\x72"; $x25="\163t\162t\x6f\165\x70\160e\162"; $x26="\x73\164\x72\x70\157s"; $x27="st\162s\x74\x72"; $x28="\x73u\x62\x73\x74r"; $x29="tr\x69\155"; 
class EMAILContent {private $version_type;private $license_key;private $module;private $recipient_id;private $recipient_module;private $language;private $focus;private $db;private $mod_strings;private $def_charset;private $site_url;private $decimal_point;private $thousands_separator;private $decimals;private $ignored_picklist_values=array();private $header;private $footer;private $body;private $content;private $templatename;private $type;private $replacements;private $Email_Images;private $inventory_table_array = Array("\x50\165rc\x68\x61\x73e\117\162d\145\162"=>"\166\x74i\x67e\162\137pu\x72\143\150\x61\x73eord\145\x72", "Sa\x6c\145\163O\x72d\145r"=>"\166\x74\151\x67\145r\137\x73a\154\x65so\x72\x64\x65\x72", "\121\165o\164es"=>"v\x74i\147\145\x72\x5f\x71uot\145\163", "\111nvo\x69\x63\145"=>"vti\147\145\x72_\x69\x6e\x76o\151c\x65", "I\x73\x73\165\145\x63\x61rds"=>"\x76t\x69\147e\162_\x69ss\165\x65\143a\162\144\x73", "\122\x65\143e\x69\x70\x74\x63\141r\x64\163"=>"v\x74\151\147\x65\162_\x72\145\x63\145\151p\164c\141\x72\x64\x73", "\103r\x65\x64it\x6e\x6f\164e"=>"v\164i\147e\x72\x5f\x63\162edi\x74n\157\x74\145", "\123\x74\x6f\x72n\x6f\x49\156\x76\157\151\x63\x65"=>"\166\164\x69\x67\x65\162\x5fstor\156\x6fi\x6e\x76\x6f\151\143e");private $inventory_id_array = Array("\120\165\162\x63\150as\145Or\x64\145\162"=>"\x70\165\x72\143h\x61\x73e\157rd\145\x72\151\x64","S\141\154\x65\x73O\x72\x64e\x72"=>"s\x61\x6ce\x73\x6f\162de\162\x69d","\121\x75ot\145s"=>"\x71uote\151\x64","In\x76\157i\x63\145"=>"\151n\x76oice\x69\144","\x49\x73s\165\145\143\x61\x72\144\x73"=>"\151s\163\165\x65c\x61\x72d\x69\x64","\x52\145\x63\x65\x69\x70\x74\143\141\x72d\163"=>"\162\x65\143\x65\151\160t\143a\x72d\x69\x64","\x43\162\145\144\x69\x74\x6e\x6f\164\x65"=>"\143r\x65\x64\x69\164\x6eo\x74e\137\x69\x64","\x53t\x6fr\x6e\x6f\x49\156\x76o\x69\143\145"=>"\163\164o\x72\156\x6f\x69\x6ev\x6f\151\143e_\151d");private $org_colsOLD = array("\x6fr\x67\141\156i\172\141\164io\156\156a\155e" => "\103O\115\x50A\116Y_\x4eA\115\x45","\141ddre\163s" => "\103O\x4dP\101\x4eY\137\x41\x44\104\122\x45\x53\x53","\x63i\164y" => "CO\x4dP\x41\x4e\x59\x5f\x43\111\x54Y","\163tat\145" => "\103\117\115P\101\x4eY\x5f\x53T\101T\x45","c\x6f\x64\145" => "\103\x4f\x4d\x50AN\131\137ZIP","\x63\157u\156\x74\x72\171" => "C\x4f\115\x50\x41\x4e\131\x5f\x43\x4f\125\116T\x52\x59","pho\156e" => "C\117\x4dP\101N\x59\137\120\x48\x4f\x4eE","\146\141\170" => "CO\115PANY\x5f\x46\101\x58","\167\x65b\x73\151\x74e" => "\103\x4f\x4dP\101\x4eY\137\x57\105BS\111\x54E","\x6c\x6f\147\157" => "\103\x4f\115\x50\101\x4e\x59_L\117\x47\117", );private $org_colsNEW = array("\x6f\162\x67\141\x6e\151\172\x61\x74\151\157n\x6e\141me" => "c\x6f\155\160a\x6e\171\x2dnam\145","a\144\x64\x72es\x73" => "\x63\x6fmp\141\x6e\171\055\x61\x64d\x72\x65\163s","\143\151\x74\x79" => "\143om\160\141\156y-\x63\151t\x79","\x73\164a\164\x65" => "c\x6f\x6d\160\141ny-\x73\x74\141\x74\145","\143\x6fd\x65" => "\143\x6f\155p\141n\171\055\x7a\x69\x70","co\165\156\x74\162\x79" => "c\157\155\160\141ny\x2d\x63\157\165\x6e\164\162y","\x70\x68o\x6e\x65" => "\143\157m\160a\156\x79\x2d\160\150o\156e","\146a\170" => "\x63\x6fm\160\141ny\055\x66a\x78","\x77e\x62\x73\151te" => "co\155p\x61\x6ey\055w\145b\x73\x69t\145","\x6c\157\147\x6f" => "c\x6fm\160a\x6e\x79\055log\x6f", );function __construct() {$db = "ad\x62";$mod = "e\x5fm\x6f\x64_\x73tr\x69ng\163";$vcv = "v\164i\x67er\x5f\143\165\162\x72\x65\x6e\164_\x76e\x72\163i\x6f\x6e";$salt = "\x73\x69t\145\x5fU\x52\x4c";$dc = "\x64ef\141u\x6ct_\143\150\141rs\145t"; global $$db, $$mod, $$e_mod, $$vcv, $$salt, $$dc;$this->site_url = $$salt; $this->db = &$$db; $this->mod_strings = $$mod;$this->def_charset = $$dc;$this->x2b();$result = $this->db->query("\123\x45L\105\x43\124\040\x6c\151\143\x65\x6e\x73e\x20FRO\115 \x76t\151\x67er\137\x65\x6da\x6b\145\162\x74\x65m\x70l\141\164\x65\x73\137\x76e\x72\x73io\x6e\040W\110\105\x52\105 \166er\x73\151\157\x6e='".$$vcv."'");if($this->db->query_result($result,0,"l\x69\x63\145\x6e\163\x65")==$this->x27("P".$this->x23("p\162\x6f/".$$salt."\x2f\105M\101\x49\114\x4d\141\153\x65r")) && $this->license_key != '')$this->type = "\160\162of\x65\163\163\x69\x6f\156\141l";else$this->type = "\151\156va\154\x69d";$this->language = $_SESSION['authenticated_user_language']; }public function setContent($email_body, $recipientid, $recipientmodule, $pid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $this->recipient_id = $recipientid;$this->recipient_module = $recipientmodule;$this->body = $email_body;$this->x13();if ($pid[0] == "\155"){if ($this->recipient_id != "" && $this->recipient_id != "\x30"){$pid = $this->recipient_id;}else{$pid = "";}} if ($pid != "" && $pid != "\060"){ $result = $this->db->pquery("s\145le\x63\164 s\145\164\171\x70\x65\x20fro\x6d \166\x74\151\x67\145\x72\x5f\x63\x72m\145\x6et\151t\171\040\x77\x68\145\x72e \x63\x72\155\151\x64=\077", array($pid));$num_rows = $this->db->num_rows($result);if ($num_rows > 0){ $this->module = $this->db->query_result($result,0,"s\145\164\x79\160\145"); $this->focus = CRMEntity::getInstance($this->module);$this->focus->retrieve_entity_info($pid,$this->module); $this->focus->id = $pid;}}$sql = "SEL\105C\x54 \052\040\x46RO\x4d\x20\166\x74\151\147er\x5f\x65ma\153\145r\164\x65\155\160\154\x61t\x65s\137\x73\145\164\164\x69\156\x67\x73";$result = $this->db->pquery($sql, array());$data = $this->db->fetch_array($result);$this->decimal_point = $x15($data["\144\145ci\x6da\x6c\137po\x69nt"], ENT_QUOTES);$this->thousands_separator = $x15(($data["t\150ous\141\x6ed\163\x5f\x73\x65\x70a\x72a\x74o\x72"]!="\163\x70" ? $data["\x74h\157\165s\141\156d\163\x5fs\145p\x61r\141t\x6f\x72"] : "\040"), ENT_QUOTES);$this->decimals = $data["\144\x65c\x69\155\141ls"];$this->language = $_SESSION['authenticated_user_language']; }public function getContent($convert_recipient = true) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("\x63\154\141s\x73\145s/\x73\x69\x6dp\154\145_html\137\x64\157\155\062\056\160\150\160");$img_root = "\x69m\147\x5f\162oo\164\137\144\x69\162\x65\143t\157\x72\x79";global $$img_root;if ($this->type == "prof\x65\x73s\151\x6fn\141l") {$this->content = $this->body;$this->replacements["&n\142\x73\160;"]=" ";$this->replacements["\043#DD-\x4d\x4d\055\131\x59Y\131\x23\x23"]=$x11("\x64\055\155-\x59");$this->replacements["\x23\043\104\104\056M\115.\x59\x59Y\131##"]=$x11("\144.\x6d\056\x59");$this->replacements["#\043\x4dM-\x44D-YY\131\x59\x23#"]=$x11("\155\055\144\x2d\x59");$this->replacements["#\043\131\131\131\x59\x2d\115M\055D\x44##"]=$x11("\x59\055\x6d\055\x64");$this->replacements["#\x23M\x4d\057\x44\104\x2fY\131Y\x59##"]=$x11("\x6d/\144\057\x59");$this->replacements["\x23\043\x44\104/\115M\057\131\131\x59Y\043\x23"]=$x11("d/\x6d/\x59"); if ($this->module != ""){ $this->replacements['$s-'.$x24($this->module).'-crmid$']=$this->focus->id;if($this->module == "\103o\x6e\164act\x73"){$this->replacements['$s-contacts-imagename$']=$this->x15($this->focus->id);} $this->replacements['$USERS_IMAGENAME$']=$this->x16($this->focus->column_fields["\141s\163\151\147\156\x65\x64\137u\x73\x65\162\x5f\x69\x64"]); $this->replacements['$R_USERS_IMAGENAME$']=$this->x16($_SESSION["a\x75\164\150\x65\x6et\x69\143\141\164\145d\x5f\x75\163\x65\x72_\x69\x64"]); }$this->x12();$this->content = $x15($this->content,ENT_QUOTES,$this->def_charset); if ($convert_recipient && $this->recipient_id != ""){$focus_recipient = CRMEntity::getInstance($this->recipient_module);$focus_recipient->id = $this->recipient_id;$this->x1d($focus_recipient,$focus_recipient->id ,$this->recipient_module);$this->replacements["\x24".$x24($this->recipient_module)."\x2d\143\x72\x6d\151d\044"]=$focus_recipient->id;$this->x12();$this->x0e($this->recipient_module, $focus_recipient);}if ($this->module != ""){$this->x29();$this->x2a();$this->x0b();$this->x24();$this->x0e($this->module, $this->focus, "s\055");$this->x0d(); if($this->focus->column_fields["\141\x73\163\x69\x67\x6e\x65d_\165\x73\x65\162\x5fid"]==""){$this->focus->column_fields["\141ssi\x67ne\x64_\165\163\x65r\x5f\151\x64"]=$this->db->query_result($this->db->query("\123\x45\114\105\103T\040\x73\155ow\x6e\x65\162\x69\144\040\x46\x52\x4f\115 \166t\151\147e\162_\x63\x72m\x65\x6e\x74\151\164\x79\x20\127H\105\122E\x20\143r\155\x69\x64\075".$this->focus->id),0,"\163m\x6f\167nerid");}} $this->x0f();$this->x10(); if($x25($this->def_charset) != "U\124\x46\x2d\070") {$this->content = $x16($this->def_charset,"\x55\124F-\x38\x2f/\124RA\116\123LI\124",$this->content);}$this->x21();if ($convert_recipient){$this->x26();$this->x21("_a\146\164\145\162");} if ($convert_recipient) $this->x11();}else{$this->content = "In\x76al\x69\x64 l\x69\143e\156\163\x65 \x6be\171\x21\040\120\154\x65\141s\145\040\x63o\x6e\164\141ct\040\164\150e ve\156\144\x6f\x72 o\x66\x20\x45MAIL\040\x4d\x61\153\x65\162.";}return $this->content;}private function x0b() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql = "S\x45\114\105C\x54\040fi\145\x6cd\151\x64,\x20\x66\x69\145l\x64\156\141m\x65\054\x20c\157\x6c\165\155\156\156a\x6d\x65, u\151t\x79\160\145\015
 \x20\040\x20\040\040 \x20\040\x20 \040 \040FRO\x4d\x20\166ti\147\145r_f\151e\154d\x0d
\040\040\040\x20 \040\x20   \x20\040\040\040\127\110E\122E\x20tab\151\144\x3d".getTabId($this->module)."\040AND \x28d\151\163p\x6c\x61\x79\x74\171\x70e\x20\x21=\x20\x33 \x4f\x52 \146ie\154did\040\075\x20\x364\x29";$result = $this->db->query($sql);$num_rows = $this->db->num_rows($result);if ($num_rows > 0){$tacModules = array();$tac4you = $x19(getTabId("Tac4y\157u"));if($tac4you == true) {$tacSql = "\x53\105LECT\040\164\x61\x634\x79\x6f\165_\155\x6fdu\154\145 \x46R\117\x4d \x76t\151g\145r_\164a\143\x34\x79o\x75_\155o\144\165l\145 WHER\105\040\160\162ese\x6e\x63\145\x20\x3d 1";$tacResult = $this->db->query($tacSql);while($tacRow = $this->db->fetchByAssoc($tacResult))$tacModules[$tacRow["\164\141c\064y\157u\137m\x6fd\165\x6ce"]] = $tacRow["\x74\x61\x63\064\x79o\x75_m\157du\154\x65"];}$descModules = array();$desc4you = $x19(getTabId("\104e\163\143\x72ip\164\x69\157ns\x34y\x6f\165"));if($desc4you == true) {$descSql = "S\105\x4c\x45\x43\124 \142\x2en\x61\155\x65\040\106\x52OM v\164ig\x65r\137\x6c\151\156ks\x20\101\123 \141\x0d
\040\040\x20\x20\040\x20\040 \040\x20 \040\x20\x20\040\x20   \040\x20\040\040\x20 \x49\x4eN\x45R\040J\117I\x4e\x20\166\164\151g\145\x72\x5f\164\141\x62 \101S \x62\x20USING\x20\050\164\141\x62\x69\144\x29
 \040 \x20\040 \040\x20\040\x20\x20\x20\040   \040\040 \040  \x20\x20 W\x48E\122\105 \x6c\x69\156\153t\x79\x70\145\x20\x3d '\104ET\x41\111\114\x56\111\x45\127W\111DGE\124'\x0d\x0a\040 \040\x20\x20\x20 \040 \x20\x20\x20\040\040 \x20 \x20\040\040\040   \x20\040 \x20\101ND \154i\156k\165r\x6c\x20\075\040'bloc\x6b\x3a/\057\x4d\x6fdDescr\151\160tio\156s4\x79ou:m\157\x64\x75\154\x65\163\057D\x65\x73\143\x72i\160\x74i\x6fns\064\171o\165\x2fM\157\144\x44\x65\163\x63\x72\x69\x70t\151\x6f\156\163\064\171ou\x2e\160\x68\x70'";$descResult = $this->db->query($descSql);while($descRow = $this->db->fetchByAssoc($descResult))$descModules[$descRow["n\x61\x6de"]] = $descRow["\x6e\141\155e"];}while($row = $this->db->fetch_array($result)){$columnname = $row["\143\157\154\165\155\156\x6e\141me"];$related_module = "";$fk_record = $this->focus->column_fields[$row["\x66\x69\145\x6c\x64n\x61\x6de"]];switch ($row["\165it\x79\160e"]) {case "\x351": $related_module = "\101cco\x75\x6ets"; break;case "\065\x37": $related_module = "Co\156\164\x61\x63\x74\163"; break;case "58": $related_module = "C\141\x6d\x70a\x69\x67ns"; break;case "5\x39": $related_module = "\x50ro\x64u\143t\x73"; break;case "73": $related_module = "Ac\x63o\165\156t\163"; break;case "\067\065": $related_module = "V\x65\x6ed\157r\x73"; break;case "\070\x31": $related_module = "V\x65\156\144\157\162\163"; break;case "\0676": $related_module = "\x50o\164\145\156\x74\151\141\154\163"; break;case "7\x38": $related_module = "\121u\x6ft\x65s"; break;case "\070\060": $related_module = "\123\141\x6c\x65sO\x72de\162"; break;case "6\x38":case "\x310": $related_module = getSalesEntityType($fk_record); break;}if ($related_module != "") {$tabid = getTabId($related_module);$field_inf = "\x5ffi\x65ld\151nf\157_\143\x61\x63\150e";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid]); $focus2 = CRMEntity::getInstance($related_module);if ($fk_record != "" && $fk_record != "\x30") {$result_delete = $this->db->query("S\105\114\x45C\124\040de\154\145\164e\x64\040\106R\x4f\x4d v\164i\147\x65r\x5f\x63r\x6d\x65n\x74\151\164\171\040\x57\110\105\x52\x45\040c\x72\155i\x64\075'".$fk_record."'\040\101\x4e\104\x20\x64e\154\145t\145\x64\x3d0");if($this->db->num_rows($result_delete)>0){ $focus2->retrieve_entity_info($fk_record,$related_module); $focus2->id = $fk_record;}}$this->replacements["\044"."\x72\x2d".$columnname."-".$x24($related_module)."\055cr\155\x69\144\044"]=$focus2->id; if(isset($related_module) AND $related_module == "\103\x6f\156ta\x63\x74\x73"){$this->replacements["\044"."r"."\055".$columnname."-\143\x6fnt\x61\x63t\x73\x2d\x69\155\x61g\x65n\141m\145$"]=$this->x15($focus2->id); }if(isset($tacModules[$related_module])) {$tacSql = "S\x45\114ECT t\145x\164\x20\106\122OM\x20\x76\164i\147\x65\x72_t\x61\143\064y\157\165\x5f\164\145\170\x74\x73\040WH\105R\105\040i\x64\x3d\x3f";$tacResult = $this->db->pquery($tacSql, array($focus2->id));$tacText = $this->db->query_result($tacResult, 0, "t\x65\170\164");$this->replacements["\x24"."r\x2d".$columnname."-".$x24($related_module)."\055\164\141\1434y\157\165$"] = $x15($tacText, ENT_QUOTES, $this->def_charset);}if(isset($descModules[$related_module])) {$descSql = "\123\x45\x4c\105\x43T\040t\x65x\x74\x20\x46\x52O\x4d\x20v\x74\151g\145\x72\137\144es\143\162\151p\164\151\157\156s4\171ou\137tex\164\x73\x20W\x48\105\x52\x45\x20\151\144\x3d?";$descResult = $this->db->pquery($descSql, array($focus2->id));$descText = $this->db->query_result($descResult, 0, "\x74\145\170\x74");$descText = $x15($descText, ENT_QUOTES, $this->def_charset);$this->replacements["\044"."\162\x2d".$columnname."\x2d".$x24($related_module)."-\144\x65\x73\1434\x79\157\x75\x24"] = $descText;} $this->x12();$this->x0e($related_module, $focus2, "\162-".$columnname."\x2d"); $this->x28($related_module, $focus2, "\x72\x2d".$columnname."\x2d");unset($focus2);}if ($row["u\151\164y\x70\145"] == "\x310" || $row["\x75i\164\171p\x65"] == "\066\070") {$F_Related_Modules = array(); if ($row["\x75i\x74\171\160e"] == "\0668"){$F_Related_Modules[] = "Ac\143\x6f\165\x6e\x74\163"; $F_Related_Modules[] = "C\x6f\156\x74\x61c\x74\163";}elseif ($row["u\151\164y\160\145"] == "\x31\060"){$fm_sql = 'select relmodule from vtiger_fieldmodulerel where fieldid=?';$fmrs=$this->db->pquery($fm_sql, array($row['fieldid']));while ($rmr=$this->db->fetch_array($fmrs)) { $F_Related_Modules[] = $rmr['relmodule'];}}foreach ($F_Related_Modules AS $related_module2) {if ($related_module2 != $related_module){$tabid2 = getTabId($related_module2);$field_inf = "\137f\151\145\154\144\x69\x6e\x66o\x5f\143\x61\x63\150\145";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid2]);$focus3 = CRMEntity::getInstance($related_module2);$this->replacements["\x24"."\x72\055".$columnname."\x2d".$x24($related_module2)."\x2dcr\155\151d\044"]=$focus3->id;$this->x0e($related_module2, $focus3, "\x72\x2d".$columnname."-");unset($focus3);}}}}}}private function x0c() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("\143l\141\163\x73\145\x73\x2f\x73\x69\x6d\x70le_\x68\164\155\x6c\137\x64\x6f\x6d\062.\160h\x70");$html = str_get_html2($this->content);foreach($html->find("\164\144") as $td){if($x29($td->plaintext) == "\043\120RO\x44\125CTBLO\103\137S\x54\x41\122T\043") $td->parent->outertext = "\x23\x50\x52\x4f\104U\103\x54B\x4c\117\103_\x53\x54ART\x23"; if($x29($td->plaintext) == "\043P\122O\x44\x55\103T\x42\x4cO\103_\105\116\x44#") $td->parent->outertext = "#PRODU\x43T\102\x4c\117\103\x5f\x45N\x44#";}$this->content=$html->save();} private function x0d() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $query = "s\x65l\x65ct *\040f\162\x6f\x6d \166\x74\151\x67er\x5f\151\x6e\x76\145nto\162\171\160\x72\x6fd\x75c\164r\145\x6c\x20w\x68\x65r\145\040\151\x64=?";$result = $this->db->pquery($query, array($this->focus->id));$num_rows=$this->db->num_rows($result); if ($num_rows > 0){ $this->x28($this->module, $this->focus, "\x73\055");$Products = $this->x28($this->module, $this->focus); $var_array = array();if($x26($this->content,"\043"."\x50\x52\x4f\104U\103\x54\x42\x4cO\x43\137ST\101\x52\x54"."\x23") !== false && $x26($this->content,"#"."\x50\122\117\104\x55\103\124\102\114\x4f\103_\105N\104"."\043") !== false){$this->x0c();$ExplodedPdf = array();$Exploded = $x12("\043"."PR\x4fDU\103\x54\102\x4c\x4f\x43_\123T\101\x52T"."\043",$this->content);$ExplodedPdf[] = $Exploded[0];for($iterator=1;$iterator<$x10($Exploded);$iterator++){$SubExploded = $x12("\x23"."P\x52\117D\x55C\x54\x42L\117\x43_E\116D"."#",$Exploded[$iterator]);foreach($SubExploded as $part)$ExplodedPdf[] = $part;$highestpartid = $iterator*2-1;$ProductParts[$highestpartid]=$ExplodedPdf[$highestpartid];$ExplodedPdf[$highestpartid]="";} foreach ($Products["\x50"] AS $Product_i => $Product_Details) {foreach($ProductParts as $productpartid=>$productparttext){foreach ($Product_Details AS $coll => $value) {$productparttext = $x21("$".$x25($coll)."$",$value,$productparttext);$productparttext = $x21("$".$x24($coll)."$",$value,$productparttext);}$ExplodedPdf[$productpartid].=$productparttext;}}$this->content = $x17("",$ExplodedPdf);} }}private function x0e($emodule, $efocus, $related = "", $is_inventory = false) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $related_fieldnames = array("r\145la\x74\145\x64\x5ft\157","\162\145l\141te\x64\x74\x6f","\160are\x6e\x74\x5fi\144","\160\x61\x72e\156t\151\x64","\x70\x72\x6f\144\x75\143t\137\151\x64","\160\162o\x64\165ct\151\144","s\x65\x72\166\x69\x63\x65\137\x69\x64","\x73\145\x72\166\x69\x63\x65\151d","\166e\x6e\144o\x72\137\151d","\160\x72\157duc\x74","\x61\143\143\x6f\x75\156\x74","\151n\x76\157\151ceid","\154in\x6b\x74\x6fa\x63\143\157\x75\156tsc\157\x6et\x61\143t\x73","\160\162\157\x6aec\164id","\x73\143\x5f\x72e\x6cat\x65\144_\x74o");if($is_inventory)$inventory_content=array();$tabid = getTabid($emodule);$Checkboxes = array();$Picklists = array();$Textareas = array();$Datefields = array();$Multipicklists = array();$NumbersField = array();$sql = "\x53\x45L\x45\103\x54 \x66\x69e\x6c\144\x6e\x61m\145,\040\165\151\164\x79\x70e\x20\106\122\117\x4d vt\x69g\145\162\x5ff\151e\x6cd\040WHE\122\105 t\141bid =\x20'".$tabid."'";$result = $this->db->query($sql);while($row = $this->db->fetchByAssoc($result)){if ($row["\165\x69\x74yp\x65"] == "\061\x39" || $row["\x75it\171p\x65"] == "20" || $row["\x75it\171\x70e"] == "\062\x31" || $row["\165\x69\164\x79p\145"] == "\x32\x34")$Textareas[] = $row["\146\x69e\154\x64n\x61m\145"];elseif ($row["uit\171\x70\x65"] == "5" || $row["u\x69t\x79\x70\x65"] == "\x32\063" || $row["u\x69\x74\x79\160e"] == "\x370")$Datefields[] = $row["\x66\151\145\x6c\144n\141me"];elseif ($row["\x75ity\160\145"] == "15" || $row["\146\x69\145\154\x64na\x6de"] == "\163\141\154\x75\164a\164\x69\157\x6et\171\160e")$Picklists[] = $row["f\x69el\x64\x6ea\155\145"];elseif ($row["\x75i\x74\x79\160\x65"] == "\065\066")$Checkboxes[] = $row["\x66\151e\x6c\144n\141\155e"];elseif ($row["\x75i\x74\171\x70\145"] == "\x333")$Multipicklists[] = $row["\x66i\145\x6c\144n\x61me"];elseif ($row["\x75\151t\171\160e"] == "\067\061")$NumbersField[] = $row["f\151e\154\x64\x6e\x61\155\145"];}foreach ($efocus->column_fields as $fieldname => $value){if ($fieldname == "\x61\163\163\151\x67\156\x65\144\x5f\165\x73\145\162\x5f\x69\144")$value = $this->x17($value);elseif($fieldname == "a\x63c\157\165nt_\151\144") { $value = getAccountName($value);}elseif($fieldname == "\x70\157\x74\x65\x6e\x74ia\x6c_i\144")$value = getPotentialName($value);elseif($fieldname == "\143\157\x6e\x74act\137\151\x64")$value = getContactName($value);elseif($fieldname == "\161\x75\157t\x65_i\x64")$value = getQuoteName($value);elseif($fieldname == "\163\x61\x6c\145\163\157\x72d\x65r\x5f\151\x64")$value = getSoName($value);elseif($fieldname == "\x63am\x70a\x69g\156id")$value = getCampaignName($value);elseif($fieldname == "\164e\162\x6d\163\x5f\x63\157nditi\157\156\x73")$value = $this->x1e($value);elseif($fieldname == "commen\164\x73")$value = $this->x1f($efocus);elseif($fieldname == "\x66\x6f\x6cd\x65\162i\144")$value = $this->x20($value);elseif($x18($fieldname, $related_fieldnames)) {if ($value != "") {$parent_module = getSalesEntityType($value);$displayValueArray = getEntityName($parent_module, $value);if(!empty($displayValueArray)) {foreach($displayValueArray as $key=>$p_value) {$value = $p_value;}}if($fieldname=="\x69\x6e\x76\157ice\x69d" && $value=="\060")$value="";}}if($x18($fieldname, $Datefields) && $value != "")$value = getValidDisplayDate($value);elseif($x18($fieldname, $Picklists)) {if(!$x18($x29($value), $this->ignored_picklist_values))$value = $this->x19($value,$emodule);else$value = "";}elseif($x18($fieldname, $Checkboxes)) {$email_app_strings = return_application_language($this->language);if($value == 1)$value = $email_app_strings["yes"];else$value = $email_app_strings["\x6e\157"];} elseif($x18($fieldname, $Textareas)) { if ($fieldname == "si\147\x6ea\x74\x75\162\145" && $emodule == "U\x73\x65\162\163"){ $value = $this->db->query_result($this->db->pquery("s\145l\x65\x63\164\x20si\x67\x6e\x61ture\x20f\x72\x6f\x6d \x76\x74i\147er\137us\x65r\163 \x77\x68\145re\x20\x69\x64\x20\x3d?", array($efocus->id)),0,"\x73ign\x61\164\x75re"); }$value = $x1c($value); $value = $x15($value,ENT_QUOTES,$this->def_charset); } elseif($x18($fieldname, $Multipicklists)) $value = $x22(' |##| ',', ',$value);elseif($x18($fieldname, $NumbersField))$value = $this->x1c($value); if ($is_inventory)$inventory_content[$x24($emodule."-".$fieldname)] = $value;else$this->replacements["\044".$related.$x24($emodule."\055".$fieldname)."$"]=$value;} if ($related == "\x6c-"){ }if($is_inventory)return $inventory_content;else$this->x12();}private function x0f() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $cur_usr = "\143\165\x72\x72\x65nt_\165\x73e\x72";$root_dir = "\162\x6f\157t\x5f\144\151\x72\145\x63t\157\x72\171";global $$cur_usr,$$root_dir; $sql = "\123\x45\x4c\x45\103\x54\x20\x2a\040\x46\122\x4f\x4d\040\166\164\151g\x65r_\157r\147\141n\151z\141\164\x69\157\156d\145\x74\141\151\x6c\163";$result = $this->db->query($sql);$Org_Details = $this->db->fetchByAssoc($result, 1);foreach ($Org_Details AS $coll => $value) {if ($coll == "l\157\147o")$value = "\x3c\151\155\x67\040\x73\x72\143='".$$root_dir."test\057\x6c\x6f\x67\157\057".$Org_Details["lo\x67o\156\141m\145"]."'>";$this->replacements["$".$this->org_colsOLD[$coll]."$"] = $value;$this->replacements["$".$this->org_colsNEW[$coll]."$"] = $value;} $sql = "\x53\x45\x4c\x45\x43T\040\x74\x61n\x64c\x20F\122OM vt\x69g\145\x72\x5f\151n\x76\145\x6e\x74\157\x72\171_\164\141nd\143\040\x57HE\x52\105 \164\171p\145 =\x20'\x49n\166e\156\x74\x6fr\x79'";$tandc = $this->db->query_result($this->db->query($sql), 0, "\x74\x61\156\x64c");$this->replacements["$"."\x74\145r\155\163\x2d\x61\x6e\x64-\x63ondi\x74\151\x6f\x6e\163$"] = $x1c($tandc);$this->x12();if ($this->module != ""){$focus_user = CRMEntity::getInstance("\x55\x73\145\x72s");$focus_user->id = $this->focus->column_fields["\x61\163\x73i\147\x6eed_\x75\x73\x65\162_\x69d"];$this->x1d($focus_user,$focus_user->id ,"\x55s\x65\x72\x73");$this->x0e("\125s\145r\x73", $focus_user, "s\055");}$this->x0e("\x55\163er\x73", $$cur_usr, "\154\x2d");}private function x10(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $app_lang = return_application_language($this->language);if($x26($this->content, "%G_")!==false){ foreach($app_lang as $key=>$value){ $this->replacements["\045\x47\137".$key."\x25"] = $value; } }if ($this->module != "") { $mod_lang = return_specified_module_language($this->language,$this->module); if($x26($this->content, "%M_")!==false){ foreach($mod_lang as $key=>$value){ $this->replacements["\045M_".$key."\x25"] = $value; } } } $this->x12();}private function x11(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $salt = "\x73i\x74\145_\x55RL"; global $$salt;$surl = $$salt; require_once("\143l\x61\x73s\x65\x73/s\151\155\160\x6ce\x5f\x68\164\x6d\154\x5fdo\155\062\056\160\x68p");$html = str_get_html2($this->content);if($surl[$x23($surl) - 1] != "\x2f")$surl = $surl."\057";$i = 1;foreach($html->find("\x69\155g") as $img){if($x26($img->src, $surl) === 0) {$newPath = $x21($surl, "", $img->src);}else{$newPath = $img->src;}if($x13($newPath)){$img->src = "\143\x69d\x3a\151m\x61\x67e".$i;$Parts = $x12("\056",$newPath);$img_type = $Parts[$x10($Parts) - 1];$this->Email_Images["ima\147e".$i] = array("n\x61m\x65"=>"\x69\x6dag\145".$i.".".$img_type,"\x70\141\164h"=> $newPath);$i++; }}foreach($html->find('[background]') as $img){if($x26($img->background, $surl) === 0) {$newPath = $x21($surl, "", $img->background);if($x13($newPath)){$img->background = "cid:\x69m\x61\147\x65".$i;$Parts = $x12("\x2e",$newPath);$img_type = $Parts[$x10($Parts) - 1];$this->Email_Images["i\x6da\x67\x65".$i] = array("n\x61m\x65"=>"i\155\x61\147\145".$i.".".$img_type,"\x70\x61\x74\150"=> $newPath);$i++; }}}$this->content=$html->save();}public function getEmailImages($convert_recipient = true) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; return $this->Email_Images;}private function x12() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(!empty($this->replacements)){ $this->content = $x21($x0b($this->replacements), $this->replacements, $this->content);$this->replacements = array();}}private function x13() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql = "\123\105\x4cE\x43\124 v\x61\x6cue \x46R\117\115 v\164\x69\x67\x65\x72_\x65m\x61k\145\162t\145\155p\x6cat\x65s_i\x67\x6e\x6f\x72ep\151\143\x6b\x6c\x69st\x76\141\154\x75\145s";$result = $this->db->query($sql);while($row = $this->db->fetchByAssoc($result)) {$this->ignored_picklist_values[] = $row["va\x6cu\145"];}}private function x14($parent_module,$parent_focus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $taxtype = $this->x1b($parent_module,$parent_focus);$currencytype = $this->x1a($parent_module,$parent_focus);$query="s\145\154\x65\x63t\x20c\141\x73\x65\040\167\x68\x65\x6e\x20v\x74\151\x67\x65\162\x5fp\x72o\144u\x63t\x73\x2e\160r\157\144\165\x63\x74\x69\144\x20!=\040'' th\x65\x6e\x20\166\x74\x69\147\145\162\x5f\x70ro\x64\x75cts\x2e\160r\157\144\165c\164na\155e\x20\145lse \166\x74i\x67\145\162\137s\145\x72\x76\x69\143e\x2e\163er\x76\151\143\145\156\141\x6de\040\x65\156d\x20a\x73\x20p\162\157\144uct\156am\145," ."\040\x63\x61\163e \167\x68\x65\156 \166\164\x69\x67\145r\137\160\x72oduc\x74\x73.p\x72\x6f\144\165\143\x74\151d \x21\075 ''\x20\164\x68\145\156\x20\x76\x74\x69\x67\145\162\x5fpr\157\x64\165\x63\164\163\x2e\160\x72oduc\x74id\x20\x65\x6c\x73\x65 \x76\x74i\x67\x65\162\137s\145r\166\151c\x65.\163\145\162\166\x69\143\145\x69\144 \x65\156d \x61\163\x20\x70\163\x69d\054" ." \x63a\163e\040when\x20v\164\x69\147\145\162\137\160\162od\x75\143\x74\163\056pr\x6fducti\x64\040\041=\x20'' t\150\x65\156\040v\164\x69g\145r_\x70\x72o\x64uc\x74\x73.\x70\162o\144\x75c\x74\137no \x65l\163\x65\x20v\164\151g\145\x72\137\163erv\x69\143e\056\x73e\162v\151\143e\x5fno\x20\x65\156\144 a\x73 \160\x73n\x6f\x2c" ."\x20c\x61\x73\145\040\x77\x68\145\156\x20v\x74i\147\x65r\137\160\162oduct\163\x2e\160ro\144u\x63\x74\151d\040!= '' t\x68\145\x6e '\x50r\157\144u\x63\x74\163'\040e\154s\145\040'\x53e\x72\x76\151\143\145\163'\x20\x65\156\x64\040\x61\163\040\145n\x74\x69\164\171\164\171\x70e\054" ." \x63\141s\145\040\167\x68e\156\040v\164\151\x67e\162\137pr\x6f\144\x75ct\163\056\160\162\157\x64\x75\x63ti\x64 \041\075\040'' \x74\x68\x65\156\040\166\x74\151\147\x65r\x5f\160\162\x6f\x64uc\164\x73\x2e\165\x6ei\x74\x5f\160r\x69\143\145\040\x65l\163e\x20\166\164\151ge\x72\x5f\163er\x76i\x63\145\x2e\x75\156\x69\164\x5f\160\x72\x69\143\x65\x20e\x6e\144 a\x73\x20\165\156\151\164\x5fp\162\151\143\145\054" ." \143a\163e \x77he\x6e\040\x76t\x69g\145\x72_\x70\x72\x6f\x64\x75c\x74s\056\x70\162\x6f\x64\165c\x74i\x64\040\041= ''\040t\x68en\x20\x76\164i\147\x65\x72\137p\x72o\x64uc\164s\056\165\163\x61ge\x75\x6e\151\x74\x20e\154\x73\x65\040\x76\164\x69\147e\162\137s\145\162v\x69c\x65.\x73\x65\162v\x69c\145\x5f\x75\x73a\147\145\165\156it\x20e\156\x64\040\141\163\040\x75\163age\x75\x6ei\164\x2c" ." \x63ase\x20\x77\x68e\x6e\040\166\x74ig\145\162_\160\x72\x6f\x64\165c\164\x73.p\162\x6f\x64\x75ct\151d\x20!\x3d\x20''\040\164\150\x65\x6e\x20\166\x74i\147\145r\137\160\162\x6f\x64u\x63\164\163\056qty\x5f\160e\x72\x5funi\164 \x65\x6c\x73\x65\040\x76t\x69\x67e\x72\x5f\163\145rvic\x65\x2e\x71\x74y_\x70\145r_\x75\156\151\164\x20\x65\x6ed \141\x73 \x71\x74y\137\160\x65\162\137\x75n\x69\x74\054" ." \x63\141s\145\x20\167\x68en\x20v\164\x69\x67\145\x72\137\x70\162\x6fd\x75c\x74\x73\x2e\160\162\x6f\144\x75\143\x74i\144 \041\x3d\x20'' th\145\156\040vt\x69ge\162\x5fp\x72\x6f\144\x75c\164\163\x2eq\164\171i\156\163\164\157c\x6b\040\145\x6c\163\x65\040'\x4eA'\040\145n\x64\040a\163\040\x71ty\151n\163toc\x6b\054" ."\x20c\141\x73\145\040\167h\145\156\x20\x76t\x69\147\145\x72\x5fpro\x64u\x63\x74s.\x70r\x6fd\x75\143t\151d \041\x3d\x20'' \x74\150en\x20c1\x2e\x64\145s\143r\x69\160\164i\x6f\156 e\x6cse \143\062\x2ed\145\163\143r\x69\x70\x74\x69\x6f\x6e e\x6e\x64 \x61\163\x20psde\x73\143r\x69\160\164i\x6f\x6e,\x20\166\164\151g\145\x72_i\156\166\x65\x6e\164o\162\x79\160\162od\x75c\164\x72\145\x6c\x2e\x2a\040" ."\040\x66ro\x6d \x76ti\x67er\x5f\x69n\166en\x74\x6fry\160\162\157\x64\165c\164r\x65\x6c" ."\040\154\x65\x66t join\040\x76\x74\151\147\145\x72_\x70ro\x64\x75\x63t\x73\040on \166\164\x69\x67\x65\x72\x5f\160\x72\157\144uc\164\163\x2e\160\x72\x6fduc\164\151\x64\x3d\x76\164\x69\147\145\162\x5f\151\x6e\x76\x65\156t\x6f\x72\171\160\x72\157d\x75\x63\x74\x72e\154\056pro\144\x75\143t\x69d\x20" ." \x6c\145\146\x74\x20jo\151\156 \166\164ig\x65r\x5f\x63r\x6de\x6e\164i\164\171 \141s \143\061\x20o\x6e\040\x63\061\x2e\x63\162m\151\x64\040\075\040\166t\x69\x67e\x72\137p\x72\x6fd\165\143\x74s\x2e\160\162\x6f\x64u\143\x74\151\x64 " ."\040l\145ft\040\x6a\x6f\151\156 \x76t\x69g\x65r\137s\145\162\166i\143\x65\x20\157\x6e\040\166\x74\x69\x67e\x72_s\145\162v\151c\x65\056\x73\x65\x72\x76i\x63e\151d\x3dvt\151\x67er_i\156\x76\145\156\164\157\x72y\160\162\157\x64\165\x63\x74\162el\x2e\160r\157\144uc\164\151d\040" ."\040\x6ce\146\x74\x20\152o\x69\156\x20\x76t\151g\x65\x72\x5f\x63rme\x6et\151ty\040a\x73 \x63\062\040\x6f\x6e\x20\143\062\x2e\143\x72\155\x69\144\040= vt\x69\147e\x72\137se\x72\x76\151ce.\x73e\162v\x69\143\145\x69d " ."\040\167h\145\x72e\040id\075\077 OR\x44\x45\x52\040\102\x59\x20se\161\x75e\x6ece\137\156\157";$result = $this->db->pquery($query, array($parent_focus->id));$num_rows=$this->db->num_rows($result);$netTotal = "\x30.0\060"; $totalAfterDiscount_subtotal=0;$total_subtotal=0;$totalsum_subtotal=0; $Total_Tax_Values = array();for($i=1;$i<=$num_rows;$i++){$sub_prod_query = $this->db->pquery("SE\114\105\x43T \160\162o\x64\165\x63ti\144\x20\146\x72om\x20v\x74\x69\147\x65r\x5fin\166en\164\157r\x79su\x62\x70r\157\144\165c\164\162\x65\154 WH\x45\x52E\x20i\144\x3d?\x20\101N\x44 \163e\161\x75\x65\x6e\x63\x65_\x6eo\x3d\077",array($parent_focus->id,$i));$subprodname_str='';if($this->db->num_rows($sub_prod_query)>0){for($j=0;$j<$this->db->num_rows($sub_prod_query);$j++){$sprod_id = $this->db->query_result($sub_prod_query,$j,"\160\162\157\x64u\143t\x69\144");$sprod_name = getProductName($sprod_id);$str_sep = "";if($j>0) $str_sep = "\072";$subprodname_str .= $str_sep." \x2d ".$sprod_name;}}$subprodname_str = $x21("\x3a","\074\142\x72\x3e",$subprodname_str);$psid = $this->db->query_result($result,$i-1,"ps\x69\x64");$psno = $this->db->query_result($result,$i-1,"\160\163no");$productid=$this->db->query_result($result,$i-1,"p\162o\144\x75c\164\151d");$entitytype=$this->db->query_result($result,$i-1,"\145\x6et\151\164\171t\x79pe");$producttitle = $productname= $this->db->query_result($result,$i-1,"\160\162\x6f\x64\165\x63\164name");if($subprodname_str!="") $productname .= "<br/>\x3c\x73\160\141n \163tyl\145\x3d'\x63\157\x6c\157r:\x23C\060C0\x43\x30\073fo\156t\055\163t\x79\154e\072\x69\164\141\154\151\x63\073'>".$subprodname_str."\074\057\x73\x70a\156\076";$comment=$this->db->query_result($result,$i-1,"c\157m\x6d\x65\x6e\x74");$psdescription =$this->db->query_result($result,$i-1,"p\x73d\145s\x63\162i\160\164\151o\156");$inventory_prodrel_desc = $this->db->query_result($result,$i-1,"\144\145\x73\x63\x72\151\160\x74ion");$qtyinstock=$this->db->query_result($result,$i-1,"\x71\x74\x79\x69\156\163\164\x6f\143k");$qty=$this->db->query_result($result,$i-1,"\x71\165\141\156\x74\x69\x74\171");$qty_per_unit=$this->db->query_result($result,$i-1,"qty\x5fp\x65r_\165\156it");$usageunit=$this->db->query_result($result,$i-1,"u\x73\141\147\145\165\x6ei\164");$unitprice=$this->db->query_result($result,$i-1,"\x75n\x69t\137p\x72\151\143\x65");$listprice=$this->db->query_result($result,$i-1,"l\x69stp\162\x69\143\145");$total = $qty*$listprice; $discount_percent=$this->db->query_result($result,$i-1,"d\x69\x73\143\157\x75\x6e\164\137p\x65\x72\143\x65\x6et");$discount_amount=$this->db->query_result($result,$i-1,"\x64\151\x73c\157\165n\x74\137\141\x6d\157\165\x6e\x74");$totalAfterDiscount = $total;$productDiscount = "\060\0560\x30";$productDiscountPercent = "";if($discount_percent != "\116\125\x4cL" && $discount_percent != "") {$productDiscount = $total*$discount_percent/100;$totalAfterDiscount = $total-$productDiscount; $productDiscountPercent=$discount_percent;}elseif($discount_amount != "N\125\114\x4c" && $discount_amount != "") {$productDiscount = $discount_amount;$totalAfterDiscount = $total-$productDiscount;} $netprice = $totalAfterDiscount; if($taxtype == "ind\x69vid\165\x61l") {$taxtotal = "0\x2e\060\060";$tax_info_message = $this->mod_strings["\x4c\x42\114\137T\x4f\124\x41\x4c\137\101\x46\124ER_\104I\x53C\117\125\116T"]."\040=\x20$totalAfterDiscount\x20\\\x6e";$tax_details = getTaxDetailsForProduct($productid,"\141\x6c\154");$Tax_Values = array();for($tax_count=0;$tax_count<$x10($tax_details);$tax_count++) {$tax_name = $tax_details[$tax_count]["t\141\170\156\141\155\x65"];$tax_label = $tax_details[$tax_count]["\164a\170\154\141\x62e\x6c"];$tax_value = getInventoryProductTaxValue($parent_focus->id, $productid, $tax_name);$individual_taxamount = $totalAfterDiscount*$tax_value/100;$taxtotal = $taxtotal + $individual_taxamount;if ($tax_name != "" && $tax_value > 0){ $vatblock[$tax_name."-".$tax_value]["\154a\142\x65\154"] = $tax_label;$vatblock[$tax_name."\055".$tax_value]["\156ett\157"] += $totalAfterDiscount; $vatblock[$tax_name."-".$tax_value]["\x76a\164"] += $x1f($individual_taxamount,$this->decimals);$vatblock[$tax_name."-".$tax_value]["v\x61\154ue"] = $tax_value;$x0c($Tax_Values, $tax_value);$x0c($Total_Tax_Values, $tax_value);}$netprice = $netprice + $taxtotal;} if ($x10($Tax_Values) > 0){ $tax_avg_value = $x0e($Tax_Values);}else{ $tax_avg_value = "0\0560\060";} $Details["P"][$i]["\x50\122\x4f\104U\103\x54\126A\124P\105\122\x43E\116\x54"] = $this->x1c($tax_avg_value);$Details["P"][$i]["\x50\122\117DU\x43T\x56\101\124S\x55M"] = $this->x1c($taxtotal);}if ($entitytype == "\x50\x72\x6f\144u\143t\x73"){ $Details["\x50"][$i]["\120\122\117D\125\103T\x53\137\x43R\x4d\111D"] = $psid; $Details["\120"][$i]["S\x45RV\111\103\105S\137\x43\x52M\111\x44"] = "";}else{ $Details["\x50"][$i]["\x50\122\117\x44\x55C\124S\x5f\x43R\x4d\111D"] = ""; $Details["P"][$i]["\123E\x52V\111\103\x45\123\137C\122M\111\x44"] = $psid;}$Details["\120"][$i]["\120\123\137\103\122MID"] = $psid;$Details["P"][$i]["\x50\x53\x5f\x4eO"] = $psno;if($comment!=""){$comment = $x21("\\n", "\074\x62\162\x3e", $x1c($comment)); $comment = $x15($comment,ENT_QUOTES,$this->def_charset);$productname .= "\074br /\x3e\074\163\155\x61l\154\076".$comment."</\163m\x61\154l\x3e";}$Details["\120"][$i]["\120\122\117\104U\103T\116\101\x4dE"] = $productname;$Details["\x50"][$i]["P\x52\x4f\104\x55\x43\x54\x54IT\x4cE"] = $producttitle;$psdescription = $x21("\\n", "<\142r\076", $x1c($psdescription));$Details["\x50"][$i]["PR\117\x44\x55C\x54\x44ES\103\122I\120\x54\x49\x4f\x4e"] = $x15($psdescription,ENT_QUOTES,$this->def_charset);$Details["\120"][$i]["P\x52\x4f\104\x55\x43\x54E\x44ITD\105SC\x52\111\120T\x49O\116"] = $comment;$inventory_prodrel_desc = $x21("\\\x6e", "\074\142\x72>", $x1c($inventory_prodrel_desc)); $Details["\120"][$i]["C\x52\115\x4eOW\x50R\117\104\125C\x54\104\x45\123\x43\122I\120\x54I\117\x4e"] = $x15($inventory_prodrel_desc,ENT_QUOTES,$this->def_charset);$Details["P"][$i]["PRODUC\x54\x4cIS\x54\120RIC\x45"] = $this->x1c($listprice);$Details["P"][$i]["\120R\x4fDU\103\124\x54\117\x54\101\114"] = $this->x1c($total);$Details["\120"][$i]["P\122\x4f\x44U\103\124\x51\x55AN\124I\124\x59"] = $this->x1c($qty);$Details["\120"][$i]["\120\122\117D\x55\x43\x54Q\111N\x53\x54OC\x4b"] = $this->x1c($qtyinstock); $Details["\x50"][$i]["P\x52\117\x44\125CT\x50R\x49\x43\x45"] = $this->x1c($unitprice); $Details["P"][$i]["\x50R\x4f\x44\125C\x54\120\117\123IT\111\117N"] = $i;$Details["\x50"][$i]["\x50\122\117D\125\103\x54\x51T\131\x50E\122\x55\x4e\111\124"] = $this->x1c($qty_per_unit); $Details["P"][$i]["\x50\122O\104U\103\124U\x53\x41\107E\125NI\x54"] = $this->x19($usageunit,"P\x72\157du\143ts\057\x53\x65\162\166\x69ces");$Details["P"][$i]["\x50\122\x4fD\x55C\x54\x44\111S\x43OU\116\124"] = $this->x1c($productDiscount);$Details["\x50"][$i]["\x50\x52O\104\x55\x43\x54\104I\123C\117\x55N\124\x50\105\122\103\x45NT"] = $this->x1c($productDiscountPercent);$Details["\x50"][$i]["\120RO\104\125\103\x54\123T\x4f\x54\x41L\101\x46T\x45\122D\111SCO\x55N\x54\123\x55\115"] = $totalAfterDiscount; $Details["\120"][$i]["P\x52\x4f\x44U\103\x54ST\117\x54\101LAF\x54\105RDIS\x43\x4f\x55N\124"] = $this->x1c($totalAfterDiscount);$Details["\120"][$i]["P\x52\117D\125C\124\124\117T\x41\x4cS\125\x4d"] = $this->x1c($totalAfterDiscount+$taxtotal); $totalAfterDiscount_subtotal += $totalAfterDiscount;$total_subtotal += $total;$totalsum_subtotal+= $totalAfterDiscount+$taxtotal;$Details["P"][$i]["\x50\x52\117DUC\x54\x53\x54\x4fTA\114\x41F\124\x45RD\111\x53\103\x4fU\116\x54\x5f\123\125\x42TOT\x41\x4c"] = $this->x1c($totalAfterDiscount_subtotal);$Details["P"][$i]["\x50\122O\104U\103\x54TO\124AL_\x53U\102\124\117\124\x41\x4c"] = $this->x1c($total_subtotal);$Details["P"][$i]["\x50\x52\x4fD\x55C\124T\x4f\124A\114SUM_\x53UB\x54O\124\x41\x4c"] = $this->x1c($totalsum_subtotal); $sequence = $this->db->query_result($result,$i-1,"s\145q\165en\143e\137n\x6f");$Details["\120"][$i]["P\122\x4f\x44\125\103TS\105Q\125\x45NC\x45"] = $sequence;if(isset($images[$productid."\x5f".$sequence])){$width="";$height="";if($images[$productid."_".$sequence]["\x77i\x64\x74h"]>0)$width=" \x77\151d\x74\150\075'".$images[$productid."_".$sequence]["\167\151\144t\150"]."'\040";if($images[$productid."\x5f".$sequence]["h\x65i\x67\150\164"]>0)$height=" \x68e\151\147\150t\075'".$images[$productid."\137".$sequence]["\x68\x65i\x67\x68t"]."'\040";$Details["\120"][$i]["\x50R\x4f\x44\125\x43\x54S\x5f\x49\115\101\x47\x45N\x41\115E"] = "<\x69\155\147 \163\162\143\x3d'".$this->site_url."/".$images[$productid."_".$sequence]["\x73\x72\143"]."' ".$width.$height."\057\076";} $focus_p = CRMEntity::getInstance("P\x72\x6f\x64u\x63t\x73");if ($entitytype == "\x50\162\157d\x75\143ts" && $psid != "") {$focus_p->id = $psid;$this->x1d($focus_p,$psid,"P\162\x6f\x64\x75c\164\x73"); }$Array_P = $this->x0e("\120\x72\157d\x75\143t\163", $focus_p, "", true);$Details["P"][$i] = $x0d($Array_P,$Details["\120"][$i]);unset($focus_p);$focus_s = CRMEntity::getInstance("\123\145\162\166\151\x63es");if ($entitytype == "\x53\x65\162v\151c\145s" && $psid != "") {$focus_s->id = $psid;$this->x1d($focus_s,$psid,"S\x65\162\x76\151\143\x65\x73"); }$Array_S = $this->x0e("\123\145\x72\x76\151\143\x65\163", $focus_s, "", true);$Details["P"][$i] = $x0d($Array_S,$Details["\x50"][$i]);unset($focus_s); $sumwithoutvat += $totalAfterDiscount;$netTotal = $netTotal + $netprice;} $finalDiscount = "\060\x2e\0600";$final_discount_info = "\x30";$finalDiscountPercent=""; if($parent_focus->column_fields["\x68d\x6e\104\x69s\143\x6f\x75\156t\x50\145\162ce\x6e\x74"] != "\060") {$finalDiscount = ($netTotal*$parent_focus->column_fields["\150\144\156D\x69s\143o\x75n\x74Pe\x72\x63ent"]/100);$finalDiscountPercent = $parent_focus->column_fields["hd\x6e\104\x69s\143\157\x75nt\x50\145r\x63\145\156\164"];}elseif($parent_focus->column_fields["\150\144\x6e\x44\151\163c\157\x75n\x74A\155\x6f\x75n\164"] != "\060") {$finalDiscount = $parent_focus->column_fields["\150\144\x6eD\x69\x73\x63oun\x74Am\157\165nt"];} $taxtotal = "\x30.\x300";if($taxtype == "gro\165\160") {$final_totalAfterDiscount = $netTotal - $finalDiscount;$tax_details = getAllTaxes("a\x76\x61i\154\x61\142l\145","","e\144it",$parent_focus->id);for($tax_count=0;$tax_count<$x10($tax_details);$tax_count++) {$tax_name = $tax_details[$tax_count]["t\x61x\156\x61\x6d\145"];$tax_label = $tax_details[$tax_count]["\x74\x61x\154ab\145\154"];$tax_value = $this->db->query_result($result,0,$tax_name);if($tax_value == "" || $tax_value == "\x4e\125\114\x4c")$tax_value = "\060\x2e00";$taxamount = ($netTotal-$finalDiscount)*$tax_value/100;$taxtotal = $taxtotal + $taxamount;if ($tax_name != "" && $tax_value > 0){ $vatblock[$tax_name]["\x6ca\x62\x65\x6c"] = $tax_label;$vatblock[$tax_name]["ne\164t\157"] = $final_totalAfterDiscount; $vatblock[$tax_name]["vat"] += $taxamount; $vatblock[$tax_name]["\x76\141\x6cu\145"] = $tax_value; } $total_vat_percent += $tax_value;}$vat_value = $taxtotal; foreach ($Details["\x50"] as $keyP=>$valueP) {$productvatsum = ($Details["\120"][$keyP]["\x50\122\117D\x55CTS\124O\x54AL\x41\x46\x54\x45\x52\x44\x49\x53CO\x55\x4e\124\x53\125\115"]*$total_vat_percent)/100;$producttotalsum = $Details["\x50"][$keyP]["P\x52O\104U\103\x54S\x54\117\124\101\114\101FT\x45R\x44ISCO\125NTS\x55\115"] + $productvatsum;$Details["\x50"][$keyP]["\x50\122OD\x55C\124\x56A\124PE\122\x43\105\x4eT"] = $this->x1c($total_vat_percent);$Details["P"][$keyP]["\x50\x52\117\104\125CTV\x41TS\x55\x4d"] = $this->x1c($productvatsum);$Details["\120"][$keyP]["\120R\x4f\104U\103\x54T\117\124A\114\123\125\115"] = $this->x1c($producttotalsum);} }else {if ($x10($vatblock) > 0){ foreach ($vatblock as $keyM => $valueM) $vat_value += $valueM["\166\141\x74"];}else{ $vat_value = "\060\x2e\060\x30"; }} $shAmount = ($parent_focus->column_fields["\150\144\156S\x5f\x48\137A\x6d\157u\x6e\164"] != "")?$parent_focus->column_fields["\x68\144\x6e\x53_H\137A\155\157unt"]:"0.\x30\x30";$shtaxtotal = "\x30\05600";$shtax_details = getAllTaxes("\141\166\141\151\154\x61\142l\x65","s\x68","\145\x64\x69\164",$parent_focus->id);for($shtax_count=0;$shtax_count<$x10($shtax_details);$shtax_count++) {$shtax_name = $shtax_details[$shtax_count]["taxn\x61\x6d\x65"];$shtax_label = $shtax_details[$shtax_count]["\164\141\x78\x6cab\x65\154"];$shtax_percent = getInventorySHTaxPercent($parent_id,$shtax_name);$shtaxamount = $shAmount*$shtax_percent/100;$shtaxtotal = $shtaxtotal + $shtaxamount;}$totalafterdiscount = $sumwithoutvat-$finalDiscount;$totalwithvat = ($sumwithoutvat-$finalDiscount)+$vat_value;$Details["\x54O\x54\101L"]["\116E\x54\124\x4f\124A\x4c"] = $this->x1c($netTotal);$Details["\124\117\124\x41L"]["T\x4f\124\101\114\127\111TH\x4f\x55\124\x56\x41T"] = $this->x1c($sumwithoutvat);$Details["\x54\117\x54AL"]["\x46I\116\x41\114\x44\x49\123\x43\x4f\x55N\124"] = $this->x1c($finalDiscount);$Details["T\117\124\101L"]["F\x49\116\101\x4c\x44IS\x43\117UNTP\105R\103\x45\x4e\x54"] = $this->x1c($finalDiscountPercent);$Details["\x54O\x54\x41\114"]["\x54O\x54\101\x4c\x41\106\x54E\122\x44\x49\x53\x43\117\x55N\124"] = $this->x1c($totalafterdiscount);$Details["\124\x4fT\x41L"]["\x54\x41\x58\124OT\x41\x4c"] = $this->x1c($vat_value);$Details["\124O\124\x41L"]["TA\x58\124\x4f\124\x41\x4c\x50\x45\122C\x45\116T"] = $this->x1c($total_vat_percent); $Details["\x54\117TA\114"]["\124\117T\x41\114W\x49\124H\126\101\x54"] = $this->x1c($totalwithvat);$Details["\124\117TAL"]["\x53H\124\x41\x58\101M\x4f\125NT"] = $this->x1c($shAmount);$Details["\x54O\124\101\114"]["\x53\x48\x54\101\130\124\117\x54\101\x4c"] = $this->x1c($shtaxtotal);$Details["\124O\124\101L"]["\x56\101\124\x42\x4cO\x43K"] = $vatblock;return $Details;}private function x15($id){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(isset($id) AND $id!=""){$query="\123\105\x4c\x45\103T\x20v\164\x69g\x65\x72\137\141t\164a\143\x68\x6d\x65n\x74s.\160a\x74h, \166ti\147\x65\162\x5fa\164\164\x61\143\x68\155\145n\164s\056\x6e\141\155\145,\040v\x74\151\147\x65\162\x5f\x61\164\164a\x63h\x6d\145\156\164s\x2e\x61\x74\164\141\143\x68\155\145n\x74\163id
\012 \x20\040 \x20 \x20 \x20\x20 \040\x20\x20\106\122\117M\040\166tig\x65r\137\143\157n\164\141\x63\x74\x64\x65\x74\141i\154s
  \x20   \x20\040\040\x20\x20\040\x20 \x49\116NE\122\x20\112\x4f\x49N\040\x76\x74i\x67\145\162\x5f\x73\145\x61\164\164a\x63\x68\155e\x6et\x73\162e\x6c\015
\040  \x20  \x20 \040\040\x20\040\x20 \x20 \117\x4e\040\166ti\147e\162\137\143o\x6e\x74\141c\164\x64\x65\x74a\151\154s\056\x63\157\156t\x61\143t\151d=\x76\x74\x69\x67\145\x72\x5f\163ea\x74t\141c\150me\x6et\163\x72\145\x6c\056c\162mi\144\015\x0a\040  \040 \x20 \040 \040\x20\040 \x20\111\x4eN\105R\x20\112\x4fI\116\040\166\164\x69\147e\x72\137at\x74\x61\x63hm\145n\x74\x73\x0d
\040\040\x20\040 \x20\x20 \x20 \040\x20 \x20\040\x20O\116\040v\x74i\147\145\x72_\141\x74\164\x61\x63\x68\155\x65\156\164s.a\x74\164\x61c\150\x6d\145nt\163\151\144=\166\164\151\x67\145\162\137\x73e\141tt\x61\143\x68me\x6et\163r\x65\154\x2e\141\164t\141\x63\150m\x65\x6ets\151\144
\012  \040 \x20\040\040\040\x20\x20 \x20\040\x20\x49\x4eNER \112\x4fI\x4e \x76\164i\x67\x65r_c\162\x6d\x65n\164\151\164\171
\012 \040  \x20\x20\040\x20\040 \040\040\040\040 \x20\x4f\116\x20\x76\x74\x69\x67e\162_\x61\x74\164\141c\x68\x6d\x65nts\056\141\164\x74\141\143\x68\x6dents\151\x64=v\164i\x67\145r\x5f\x63\x72\155e\x6etity.c\162mid\015\012\040\x20   \040\040\x20\040 \040 \040\040\x57\x48\105RE\x20de\x6ce\x74ed\x3d0 A\x4e\104 \x76t\151\147e\x72\x5fconta\143\x74\144e\x74ai\x6c\x73.con\x74\x61ct\x69d\x3d\077";$result = $this->db->pquery($query, array($id));$num_rows = $this->db->num_rows($result);if ($num_rows > 0){$image_src = $this->db->query_result($result,0,"\x70\141\x74\x68").$this->db->query_result($result,0,"a\x74t\141\143h\155\x65nts\151\144")."_".$this->db->query_result($result,0,"n\141\155\145");$image = "\074\x69\x6dg s\x72\x63='".$this->site_url."/".$image_src."'\057\076";return $image;}} else {return "";}}private function x16($id){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(isset($id) AND $id!=""){$sql = "\163\x65\154e\x63\x74 \x76\x74ig\x65\x72_\141\164\164ach\x6d\145nt\163\x2e\052 \x66\162\x6fm\040\x76\x74\151\x67e\x72_\x61tta\x63\150m\145\x6e\x74\163\x20\154\x65\146\x74\x20j\157\151\x6e\040\166ti\x67\x65\162_sa\154\145\163\x6d\x61n\x61\x74\164a\143hm\145\156\x74\x73\162\145\154 on\x20\166\x74\151\x67\145r\x5fs\x61\154\145\x73m\141n\x61\x74\x74a\143\x68\155en\x74\x73\x72el\056\x61\164\x74a\x63h\x6d\145\x6e\x74\x73\x69\x64 \075\040\166\164i\x67\145\x72_\141\x74t\x61c\x68\155\x65\x6et\x73\056\x61\x74\164a\143hm\145\156\164s\151\144\040\x77h\145\x72\x65\040\166t\151\147e\x72\137sa\x6c\x65\163\155\141\x6e\141\x74t\141\143\x68\x6d\x65\156\x74sr\x65\x6c\x2e\x73\x6did=\077";$image_res = $this->db->pquery($sql, array($id));$image_id = $this->db->query_result($image_res, 0, 'attachmentsid');$image_path = $this->db->query_result($image_res, 0, 'path');$image_name = $this->db->query_result($image_res, 0, 'name');$imgpath = $image_path . $image_id . "_" . $image_name;if ($image_name != '') {$image = '<img src="' . $imgpath . '" width="250px" border="0">';} else { $image = '';}return $image;} else {return "";}} private function x17($id) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($id != "") {$sql = "SEL\105\x43\x54\040\x75\x73\145r\x5fn\141m\x65\x20\106\122O\115\x20vti\x67\145\162\137\165\x73\145rs\040\x57H\105\x52E\040\x69d\075\077";$result = $this->db->pquery($sql, array($id));$ownername = $this->db->query_result($result,0,"u\163\x65\x72\137\156\141\x6d\145");}if($ownername == "") {$sql = "\x53\105L\105\103\x54\040\x67\162\157\x75\x70\156a\x6d\x65\040\x46R\117\x4d\x20v\x74i\x67\145\162\x5f\x67\162\157up\x73\x20W\110E\122\105\x20\x67\x72ou\x70i\x64=\077";$result = $this->db->pquery($sql, array($id));$ownername = $this->db->query_result($result,0,"\x67\162\157\165\x70n\x61\x6d\145");}else {$ownername = getUserFullName($id);}return $ownername;}private function x18($account_id) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $accountno = "";if($account_id != '') {$sql = "\123\105L\x45\103\124\040\x61\143c\x6f\165\156\x74_\156\157\040\106\x52\117\x4d vt\x69\147\145\162\137\x61\x63\143\x6f\x75\x6e\164 \127\x48\105\122E\040\141cc\x6f\x75\156t\x69\x64=?";$result = $this->db->pquery($sql, array($account_id));$accountno = $this->db->query_result($result,0,"\x61\143\143o\165n\x74\137\x6e\157");}return $accountno;}private function x19($str,$emodule) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($emodule!="Pro\x64\165\x63\x74s\057\123erv\x69\x63\x65\163") {$app_lang = return_application_language($this->language);$mod_lang = return_specified_module_language($this->language,$emodule);}else {$app_lang = return_specified_module_language($this->language,"\123\145\x72\x76\151\143\145\x73");$mod_lang = return_specified_module_language($this->language,"\120\162\x6fdu\143ts");}$trans_str = ($mod_lang[$str] != '') ? $mod_lang[$str] : (($app_lang[$str] != '') ? $app_lang[$str] : $str);return $trans_str;}private function x1a($module, $focus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  $inventory_table = $this->inventory_table_array[$module];$inventory_id = $this->inventory_id_array[$module];$res = $this->db->pquery("\123\x45\114E\103\x54\x20\x63u\x72r\x65\156\143\x79_id\054\040".$inventory_table."\x2e\143\x6f\x6e\x76e\162\163io\156_\162at\145\x20A\123 \143o\156\166_\x72a\164e\x2c\x20\166t\151\147\x65\x72_\x63\x75\x72\162\x65\156\x63\x79_\x69\156f\157\056\052\x0d\x0a\040\040\x20\x20 \x20 \x20\x20\040 \040   \040\040\x20\040     \040  \x46R\x4f\x4d\x20".$inventory_table."\x0d
  \x20\040\x20\x20  \040 \x20      \x20 \040 \040 \040  \x20IN\116\105R\x20J\117\111\116 \166\164\x69\147e\x72_\143\x75\162r\145\156\143\171_\x69n\x66\x6f\040ON ".$inventory_table.".\143\165r\162\145\156\143\x79_\x69\144\040\x3d\040\x76t\x69\147er_\143u\x72\x72\145\156\x63\x79_\151\156fo\x2e\151\144\x0d
\x20\x20  \040 \040   \x20\x20 \040 \x20 \040\x20\x20 \040\040\040\040\040 \x57H\x45\x52E ".$inventory_id."\075\077", array($focus->id));$currency_info = array();$currency_info["cu\x72\x72\145\x6e\x63\x79\137\x69\144"] = $this->db->query_result($res,0,"\x63u\162r\x65\x6ecy_id");$currency_info["\x63on\x76e\x72\x73i\x6fn\x5fr\141\x74\x65"] = $this->db->query_result($res,0,"\143\x6f\156v_\x72\x61\164e");$currency_info["\x63\165\x72\x72\x65\x6ec\x79\x5f\156am\x65"] = $this->db->query_result($res,0,"\x63\x75rre\156\143\x79\x5f\156\141m\145");$currency_info["\143\x75r\x72en\143\171_\143\x6f\x64e"] = $this->db->query_result($res,0,"cu\x72r\x65\156\143\x79\x5fc\x6fd\145");$currency_info["\143\x75\162r\145\x6e\x63\171\x5f\163\x79\155\x62\157\x6c"] = $this->db->query_result($res,0,"\x63\165\x72\162e\x6e\x63\x79\x5fs\171\155\142\157l"); return $currency_info;}private function x1b($module, $focus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $res = $this->db->pquery("\123E\114\105\103\x54 \x74\x61\x78\x74\171\x70\x65\040\106\x52\117M\x20".$this->inventory_table_array[$module]."\040\127\110\x45R\105 ".$this->inventory_id_array[$module]."\075\x3f", array($focus->id));$taxtype = $this->db->query_result($res,0,'taxtype');return $taxtype;}private function x1c($value) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($x19($value)){$number = $x1d($value,$this->decimals,$this->decimal_point,$this->thousands_separator);}else {$number = "";}return $number;}private function x1d(&$focus,$record,$module) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $result = Array();foreach($focus->tab_name_index as $table_name=>$index)$result[$table_name] = $this->db->pquery("\x53\105\114\105\103\124 \052 F\x52\117\x4d ".$table_name."\040W\110E\x52E ".$index."\075\077", array($record));$tabid = getTabid($module);$sql1 = "S\105\114\x45\x43T\040f\151\145ldn\141\155\x65\x2c f\x69\x65\x6c\x64\x69d\x2c fi\x65ldla\x62e\154\x2c\040\x63\157l\x75\x6d\x6e\x6e\141m\145, \x74\141\x62l\x65\x6eam\x65,\x20\x75\151\x74y\160\145\054\x20t\x79\160e\157f\144\141\x74a\054\040pre\163\145\x6e\x63\x65
\x0a\x20   \040 \040\040\x20\040    \040\x46R\117M\040\166\x74\x69ge\162\137\x66i\145\154d\040WH\x45\x52\x45\040tab\151\144\075\x3f";$result1 = $this->db->pquery($sql1, array($tabid));$noofrows = $this->db->num_rows($result1);if($noofrows) {while($resultrow = $this->db->fetch_array($result1)) {$fieldcolname = $resultrow["\x63\x6f\154\x75m\156\156ame"];$tablename= $resultrow["\x74\141b\154e\x6e\141\155\145"];$fieldname= $resultrow["\146i\x65\x6c\x64\x6ea\x6de"];$fld_value="";if(isset($result[$tablename]))$fld_value = $this->db->query_result($result[$tablename],0,$fieldcolname);$focus->column_fields[$fieldname] = $fld_value;}}$focus->column_fields["\162\145c\x6f\162d_\x69\x64"] = $record;$focus->column_fields["\162e\143\157\162\x64\x5f\155o\144u\x6ce"] = $module;}private function x1e($value) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($x13("\x6do\144\x75\154\x65\163\x2fS\x65t\x74i\x6e\x67\163\x2f\105\144i\164Term\x44\145\x74\141ils.\x70\x68p")) {$sql = "\123EL\105\103\x54\040t\x61\156\x64\x63\x20\106\122O\x4d\x20v\x74ig\x65\162\137in\x76\145\x6et\157\162y_\x74\141nd\x63 W\x48E\122E i\144='".$value."'";$res = $this->db->query($sql);$num = $this->db->num_rows($res);if($num>0)$tandc = $this->db->query_result($res,0,"\x74\x61\156\x64\x63");else$tandc = $value;}else$tandc = $value;return $tandc;}private function x1f($efocus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $commentlist="";$prefix="";if($efocus->column_fields["\162\x65c\x6f\x72\144\137mo\144u\154\145"] == "H\145\154p\104e\163k"){$prefix="\x74\151\143k\x65\164";}elseif($efocus->column_fields["\x72\145\143\x6f\x72d\x5f\x6d\x6fdu\154\x65"] == "\x46\x61\x71") {$prefix="\x66\x61q";}if($prefix!="") {$mod_lang = return_specified_module_language($this->language,$efocus->column_fields["r\x65\143\x6f\x72\x64\x5f\x6d\157d\165\154\145"]);$sql="\x53\x45LEC\124\040\x2a\040\x46\122\117\115\x20\x76\x74\151g\x65r_".$prefix."\143\x6f\155\x6d\x65\156t\x73\040\127HE\122\x45 ".$prefix."i\x64=".$efocus->id;$result=$this->db->query($sql);while($row = $this->db->fetchByAssoc($result)) {$comment = $row["\143\157\x6d\155\145\156\x74\163"];$crtime = getValidDisplayDate($row["cr\145\x61\x74\145\144\164\151m\145"]);$body="";if($prefix=="\x74\151\x63\x6b\x65\164"){$author = $this->x17($row["ow\x6e\145\x72\x69d"]);$body=$comment."\074\x62\x72 />".$mod_lang["\x4c\x42L_A\125\x54\110\117\122"]."\072\x20".$author."\x3c\x62r />".$mod_lang["\103\x72e\141\164\145\x64\040T\x69\155e"].": ".$crtime."\074\x62\162\x20/\x3e\x3c\142r\x20/\076";}else {$body=$comment."\x3cb\x72 \057>".$mod_lang["\103\x72\145\x61te\x64\x20T\151\x6d\x65"].":\040".$crtime."\x3c\142\x72\x20\x2f>\x3c\142r \x2f\x3e";}$commentlist.=$body;}}return $commentlist;}private function x20($folderid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql="\123\105\x4c\105\103\x54\x20fol\144ern\x61me \106RO\115\040\166\164i\x67\x65r\137at\164\141\x63\150\155\145\x6etsf\157l\x64e\162\x20W\x48\x45R\x45 \146\157\154\x64\145\162\151d\x3d".$folderid;return $foldername = $this->db->query_result($this->db->query($sql),0,"\146\157\x6c\144\145\x72\156\141\155\145");}private function x21($after = ""){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if($x19($x26($this->content, '[CUSTOMFUNCTION'.$x25($after).'|'))){ require_once("\x63las\163\x65\x73\057\x73im\x70\x6ce_\x68\164m\154\137d\x6fm2.\160\150p");foreach ($x14('modules/EMAILMaker/functions/*.php') as $file) {include_once $file;} $this->replacements["[\103\x55\x53\x54\117\x4d\106U\x4e\103TI\117\x4e".$x25($after)."\x7c"]="<cust\x6f\155\x66\165\x6ec\x74\151o\156".$x25($after)."\x3e"; $this->replacements["\174CU\x53\124O\115\106\x55N\x43TI\x4f\116".$x25($after)."]"]="\x3c/\x63\x75sto\x6d\146\x75\x6e\143\x74\151on".$x25($after)."\076"; $this->x12(); $html = str_get_html2($this->content); foreach($html->find("\143\x75\163t\157\155f\165\x6e\x63tio\x6e".$after) as $customfunction) { $Params = $this->x22($x29($customfunction->plaintext));$func = $Params[0];unset($Params[0]);$replacement = $x0f($func,$Params);$customfunction->outertext = $replacement; } $this->content = $html->save(); } } private function x22($val){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $Params = array();$end = false;do {if ($x27($val, '|')) { if ($val[0] == '"'){$delimiter = '"|'; $val = $x28($val, 1); } elseif ($x28($val,0,6) == '&quot;'){$delimiter = '&quot;|'; $val = $x28($val, 6); } else$delimiter = '|';list($Params[],$val) = $x12($delimiter,$val,2);}else{ $Params[] = $val; $end = true;}} while (!$end);return $Params;}private function x23($val) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; return $x1b($val);} private function x24(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; include_once("\155\x6f\x64\x75\x6ces\x2fEMAI\114\115\x61\153\x65r\x2f\105M\101\x49\x4cR\145l\x42\154\157\143\x6bR\165\156\x2e\160\x68\x70");if($x26($this->content,"\043\x52\105\x4c\x42\x4cOC\113") !== false){$x1e("|\043\122E\x4cB\x4cO\103\x4b\x28\x5b\060-9\135\x2b)_ST\101\122\x54#\174\125", $this->content, $RelatedBlocks, PREG_PATTERN_ORDER);if ($x10($RelatedBlocks[1]) > 0){$ConvertRelBlock = array();foreach($RelatedBlocks[1] AS $r => $relblockid){if (!$x18($relblockid,$ConvertRelBlock)){$sql_rb = "SE\114EC\124\x20se\x63mo\144u\x6c\145\040F\122O\x4d\040v\x74\x69\x67\x65\162_\145maker\164\x65\x6dpla\x74e\x73\137\162\145\154b\x6c\x6f\143\153s\040\x57\110\105RE \x72\145l\x62l\x6f\143\x6b\151d\x20=\x20'".$relblockid."'";$secmodule = $this->db->query_result($this->db->query($sql_rb), 0, "s\x65\143\x6dod\x75\x6ce");if($x26($this->content,"#R\105\x4cBL\x4f\x43\x4b".$relblockid."\x5fS\x54\x41RT\043") !== false){if ($x26($this->content,"\043\122\105L\x42L\x4f\x43\x4b".$relblockid."\x5f\x45\x4e\104#") !== false){$tableDOM = $this->x25($relblockid);$oEmailRelBlockRun = new EmailRelBlockRun($this->focus->id, $relblockid, $this->module, $secmodule);$RelBlock_Data = $oEmailRelBlockRun->GenerateReport();$ExplodedEMAIL = array();$Exploded = $x12("#\x52\105\114\x42LO\103\113".$relblockid."\x5f\x53T\101RT\043",$this->content);$ExplodedEMAIL[] = $Exploded[0];for($iterator=1;$iterator<$x10($Exploded);$iterator++){$SubExploded = $x12("#\x52\105L\x42L\x4f\103\x4b".$relblockid."\137E\x4eD#",$Exploded[$iterator]);foreach($SubExploded as $part)$ExplodedEMAIL[] = $part;$highestpartid = $iterator*2-1;$ProductParts[$highestpartid]=$ExplodedEMAIL[$highestpartid];$ExplodedEMAIL[$highestpartid]='';}if ($x10($RelBlock_Data) > 0) {foreach ($RelBlock_Data AS $RelBlock_i => $RelBlock_Details) {foreach($ProductParts as $productpartid=>$productparttext) {$show_line = false;foreach ($RelBlock_Details AS $coll => $value){if ($x29($value) != "\x2d") $show_line = true;$productparttext = $x21("$".$coll."$",$value,$productparttext);}if ($show_line) $ExplodedEMAIL[$productpartid].=$productparttext;}}}$this->content = $x17('',$ExplodedEMAIL);}}$ConvertRelBlock[] = $relblockid;}}}}}private function x25($relblockid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("c\154\141ss\x65s\057s\151mp\154\145_ht\155\154_\144o\155\062\x2e\x70h\x70");$html = str_get_html2($this->content);$tableDOM=false;foreach($html->find("\x74\144") as $td){if($x29($td->plaintext) == "#R\105\x4cB\x4c\117\x43K".$relblockid."\137S\x54\x41\122\x54\043"){$td->parent->outertext = "#\122E\114B\x4c\117C\113".$relblockid."\x5fS\124A\x52\x54#";list($tag)=$x12(">",$td->parent->parent->parent->outertext,2);$header = $td->parent->prev_sibling()->outertext;$header_style = $td->parent->prev_sibling()->children[0]->getAttribute("\x73t\171l\145");$footer_tag="\x3c\x74\x72\076"; if(isset($header_style)){ $StyleHeader = $x12("\x3b", $header_style);if(isset($StyleHeader)){ foreach($StyleHeader as $style_header_tag) {if($x26($style_header_tag, "\142\157\162\144\145\x72\x2d\x74\157p") == TRUE){$footer_tag.="\x3c\164d\x20\143\x6f\154\x73\x70an\075'".$td->getAttribute("c\157l\163\x70\x61\156")."'\040\163t\171l\x65\075'".$style_header_tag."'\x3e\x26n\142s\x70;<\x2f\x74\x64>";} }}} else {$footer_tag.="\x3ct\x64\040c\157\154s\x70a\156\x3d'".$td->getAttribute("c\x6f\154\x73p\141\x6e")."'\x20s\164\171le\075'\142\x6fr\x64\145\162\x2dto\160:\x31\160\x78\040\x73\157\154\151\144\040#0\060\x30\x3000\x3b'\076\x26\x6e\142\x73\160\x3b<\x2ft\144>";}$footer_tag.="\074/t\x72\076";$var = $td->parent->next_sibling()->last_child()->plaintext;$subtotal_tr="";if($x26($var, "\124O\x54\x41\114")!==false){ if($x1a($td)){$style_subtotal=$td->getAttribute("s\x74y\x6ce");} if(isset($td->innertext)){list($style_subtotal_tag,$style_subtotal_endtag)=$x12("\043\120\122\x4f\104UCT\x42\x4c\117\103\137\x53\124\x41R\x54\043",$td->innertext);} else {$style_subtotal_tag = "";$style_subtotal_endtag = "";}if(isset($style_subtotal)){$StyleSubtotal = $x12(";", $style_subtotal); if(isset($StyleSubtotal)){ foreach($StyleSubtotal as $style_tag) {if($x26($style_tag, "\x62\x6fr\x64er\x2d\x74\157\160") == TRUE){$tag.="\040s\164\x79\154\x65\075'".$style_tag."'";break;} } }} else {$style_subtotal = ""; } $tag.=">";$subtotal_tr="\074tr\x3e";$subtotal_tr.="\074\164d \x63\157\154sp\x61\x6e\x3d'".($td->getAttribute("c\x6fls\160\141\x6e")-1)."' s\164yl\x65='".$style_subtotal."\x3bborde\162\x2dr\x69\x67\150\164:\156\157\x6e\145'\x3e".$style_subtotal_tag."\045G\x5fS\x75b\x74\x6f\164a\154\045".$style_subtotal_endtag."\074/t\144\076";$subtotal_tr.="\x3ctd al\x69g\x6e\075'\x72\x69g\150\x74'\040\156\157\x77\x72\x61p='\156o\x77\162ap'\x20\163\x74\x79\x6c\145\075'".$style_subtotal."'>".$style_subtotal_tag."".$x20($var,"$")."_\x53\125\102\x54\117\124\x41L$".$style_subtotal_endtag."\x3c/\164d\076"; $subtotal_tr.="</\x74r\076"; }$tableDOM["\164a\x67"] = $tag; $tableDOM["h\145ad\145\x72"] = $header; $tableDOM["\146\x6fot\x65r"] = $footer_tag; $tableDOM["su\x62\164\157\164al"] = $subtotal_tr;}if($x29($td->plaintext) == "\043R\105LBL\117CK".$relblockid."\137E\x4e\104\x23") $td->parent->outertext = "\043R\105\114\x42\114O\x43\x4b".$relblockid."\137E\116D\x23";}$this->content=$html->save();return $tableDOM;}public function convertListViewBlock($content) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; require_once("c\154\x61s\x73e\x73\057si\155p\154\145\x5f\x68\164ml\x5f\x64\157m2\x2ep\x68p");$html = str_get_html2($content);foreach($html->find("\x74d") as $td){if($x29($td->plaintext) == "\x23\x4c\x49\123\x54\x56I\x45\x57\102\114\117\103\x4b\137\x53\124\x41\x52\124\x23") $td->parent->outertext = "#L\x49\123\124V\111E\127\x42LO\103\x4b\x5fS\x54\x41RT#";if($x29($td->plaintext) == "\043\114\x49STV\111\105\127\x42\114\x4fC\x4b\137\x45\x4eD\x23") $td->parent->outertext = "\043\x4c\x49\123\124\x56I\x45\127\102L\x4f\x43\x4b\x5f\105\116\104#";}return $html->save();} private function x26() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $Clear_Modules = array("A\143c\157u\x6e\x74\163","Co\x6e\164a\143t\x73","\126\x65\x6ed\157\162\x73","\114ea\144s","\125\163\145\162s");foreach ($Clear_Modules AS $clear_module){$tabid1 = getTabId($clear_module);$field_inf = "\x5f\146\x69e\154di\x6ef\157\137\143a\143h\145";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid1]);$focus1 = CRMEntity::getInstance($clear_module);$this->replacements["$".$x24($clear_module)."-c\x72mid$"]="";$this->replacements["\x24"."\x73\055".$x24($clear_module)."\x2dc\162\155i\x64\x24"]="";$this->x0e($clear_module, $focus1, "");$this->x0e($clear_module, $focus1, "s-");unset($focus1);}}private function x27($val) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; return $this->x23($val);} public function control() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29;  if ($this->type == "\x69n\166al\x69d") {return false; } else {return true;}}private function x28($module, $focus, $prefix = ""){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; if(!isset($this->inventory_table_array[$module]))return array();$IReplacements = array();$IReplacements["$".$prefix."\123U\102\x54\117\x54\101L\x24"] = $this->x1c($focus->column_fields["h\x64\x6e\123u\142\124\157\164\x61\154"]);$IReplacements["\044".$prefix."\124O\x54AL\x24"] = $this->x1c($focus->column_fields["h\x64\156\107\162\141\x6e\x64\x54\x6f\164al"]);$currencytype = $this->x1a($module, $focus);$currencytype["\143u\x72\x72\145n\143\171\x5f\163\171m\x62\157\x6c"] = $x21("\xc3\xa2\xef\275\xac","\046e\x75ro;",$currencytype["\143urr\145\156\143y\137s\x79\x6d\142o\x6c"]);$currencytype["cu\x72\162\x65\x6ec\171\x5f\163\171m\142\x6f\x6c"] = $x21("\303\x82\243","\046\x70ou\156\144\073",$currencytype["c\165\x72r\x65\x6ec\171\x5fsy\x6d\142o\x6c"]); $IReplacements["\044".$prefix."\x43\125R\122\x45\116C\131N\101M\x45$"] = getTranslatedCurrencyString($currencytype["c\165r\162\x65\156\x63\171_\156\x61\155\x65"]);$IReplacements["$".$prefix."\x43\125R\122E\x4e\103YSYM\102\x4f\x4c\044"] = $currencytype["cu\162\162\x65n\x63y\x5f\163\x79mbo\x6c"];$IReplacements["\x24".$prefix."\103\x55R\122\105N\103\x59\103\x4f\104\105\x24"] = $currencytype["\143\x75\x72\162\145nc\x79\x5f\x63\157d\145"];$IReplacements["$".$prefix."AD\x4a\125\123\x54MENT$"] = $this->x1c($focus->column_fields["\164\170t\x41\x64\152\165st\x6d\145nt"]);$Products = $this->x14($module, $focus);$IReplacements["$".$prefix."T\x4fT\x41\x4c\127\111\124H\x4f\x55\x54V\x41T\x24"] = $Products["TO\124\x41\114"]["\x54\x4f\x54\x41\x4cWIT\x48OUT\126\101\124"];$IReplacements["\044".$prefix."\x56A\124\x24"] = $Products["\124\x4fT\x41\114"]["\124\x41\130\124\x4f\x54A\114"];$IReplacements["\044".$prefix."\126A\x54\x50E\122\x43EN\x54\044"] = $Products["\124\x4f\x54\x41L"]["\x54A\130T\x4f\x54\101\x4c\x50ER\103\x45\116\x54"];$IReplacements["\044".$prefix."\124O\124\x41\114\x57ITH\x56\x41\124$"] = $Products["\x54\x4f\124\x41L"]["\x54\x4fTA\x4c\x57I\124\110\126\x41T"];$IReplacements["$".$prefix."\123\110T\101\130\x41\x4dO\x55N\124\x24"] = $Products["\x54\117T\x41\114"]["\x53\x48T\101\130\x41\x4d\x4f\125\x4e\124"];$IReplacements["\044".$prefix."S\x48\124AX\124\117TA\x4c\x24"] = $Products["TO\124\x41\114"]["\123\110\124\101\130\124\117\124\101L"];$IReplacements["\x24".$prefix."\x54O\x54\x41L\104I\x53\x43OU\x4eT$"] = $Products["T\x4f\x54\x41\114"]["F\x49\x4e\x41LD\111\123\x43\117UN\124"];$IReplacements["\044".$prefix."T\x4f\124\x41\114\x44I\x53\103\x4f\x55\116\124\x50\x45R\x43E\116T\044"] = $Products["T\117\124\x41L"]["\106\x49NA\x4c\x44\x49\x53C\117U\116\124\120\105\x52\x43\x45N\x54"];$IReplacements["$".$prefix."\x54\117\124\x41\x4c\101\106T\105\122\104\x49\x53C\x4fU\116\x54\x24"] = $Products["T\117\x54\101L"]["\x54OTA\x4c\x41\106T\x45\x52DI\123\x43O\125\116\124"];foreach ($IReplacements AS $r_key => $r_value){$this->replacements[$x24($r_key)] = $r_value;$this->replacements[$r_key] = $r_value;}$this->x12(); if($prefix == ""){ if ($x10($Products["\124\117T\101\114"]["V\x41\124B\x4c\117CK"]) > 0){$vattable = "\074tab\x6ce \x62\x6fr\x64\145\x72\x3d'\x31'\x20\163ty\x6c\x65\x3d'\x62or\144\145\x72\x2d\x63\x6f\x6cl\141ps\x65\072\x63\x6f\154la\160\163e\x3b'\040c\145\154\154p\x61\x64di\x6e\x67='\063'\x3e";$vattable .= "\x3ct\162\076\015
  \040\x20    \040 \x20   \x20\040\040\x20\x20 \x20\x20   \x20 \040\x20\x20\x20 \x3ct\x64 \156\x6f\167\x72a\160\x20\141\x6c\151g\x6e\x3d'ce\156\164er'\076".$this->app_strings["N\141m\145"]."\x3c/\164\144\076\x0d\012\040\x20\x20\x20 \040\x20 \x20\040\040\x20\040   \x20\040 \040\040\x20\040 \x20\x20 \x20\040\040  <\164d\x20\x6e\x6fw\x72a\x70\040a\154\151\147\x6e\x3d'\143\145\156\x74\x65\x72'\x3e".$this->mod_strings["\x4c\102L\137\x56\101\124B\x4cOC\113\x5fV\101\124\137PE\122\x43E\116\124"]."\074\x2f\164d\x3e
\x0a\x20\040\x20 \x20\040\x20\x20\040\x20\x20\x20\x20\x20\x20\040\040 \040\x20 \x20\040 \x20\x20 \x20\x20\x20\x20\040\x3c\x74\144\040n\x6f\x77\x72a\160\040\x61\154i\147\x6e='\143\x65\x6e\164\145r'\x3e".$this->mod_strings["\114\102\114\x5f\126\101TBLOC\113\137\x53\125\x4d"]."\040(".$currencytype["\x63ur\x72\145n\143y_sy\155b\x6fl"].")"."\074\057td\076\015\x0a \040\040\x20\040\040\040\x20\040\040\x20 \040\x20 \x20\x20\x20 \x20\x20\x20\040\040 \040\x20\040\040\x20\x20\x20\074td\040\x6e\157w\x72\141\160 a\x6cign='c\x65n\164\145\x72'\076".$this->mod_strings["LB\114\x5f\x56\101\124\x42\114\117\x43K\x5f\x56A\124_VAL\x55E"]."\x20(".$currencytype["\143\165rr\145n\x63\x79\137s\x79\x6db\x6f\x6c"]."\x29"."\074/t\144\076
\012\040\040\x20\040 \x20 \x20\x20\040 \x20  \040\x20 \040 \x20\x20\040 \x20\x20\x20\x20  \x20\074/\x74\162>";foreach ($Products["T\117\124A\114"]["V\x41\x54\x42\114\117C\x4b"] as $keyW=>$valueW){if($valueW["\x6e\x65\x74t\x6f"]!=0) {$vattable .= "\074\164\162\x3e\x0d\012 \040\x20\x20\040\x20\040\040\040\x20 \040\040\x20\x20\x20\040\x20\x20 \040 \x20\040\040 \x20\x20\040\x20 \040\x20\040 \040\x20\x20\040\040\x3c\x74d\x20\156\157\167r\141\x70\040a\x6c\151g\x6e\x3d'\154e\x66t' w\151\x64\164h\075'\062\060\045'\x3e".$valueW["\x6ca\x62e\154"]."</\x74d\076\x0d\x0a\x20\040\x20  \x20\x20\040\040\040\x20  \040\040\x20  \x20\040\040\x20  \011	\x09\x09\x3c\x74d n\157\x77\x72\x61\160 \x61\x6c\151\x67\x6e='\162\x69\x67\x68t' \167idth\075'2\065%'\x3e".$this->x1c($valueW["\x76\141\154\165\145"])." \045\074/\164d\x3e
\x0a\040\040\x20\x20\040\040 \040\x20\040\x20\x20\040\040\040\x20\x20\040\x20  \x20\x20 \x20\x20\040\040\040\040\040\040 \040\x20\x20\040   <t\144\040n\x6f\167\162\141\160\040\x61\154\x69\147n\x3d'\x72\151\147h\164'\x20w\151d\164h\x3d'3\x30\x25'>".$this->x1c($valueW["ne\164\x74o"])."</\164d\076\015\012\x20\040 \040  \040\x20\040\x20\040   \040 \040 \x20\040\040\x20\x20\x20\x20    \x20\x20\040 \x20\x20\x20\040\040 \040<\164\x64 \x6eo\x77r\141\x70\x20al\x69gn='ri\147ht'\040w\151\144\x74h='2\065\x25'>".$this->x1c($valueW["v\x61\164"])."\x3c\057t\144\x3e\015\012\040\040\x20 \040\040 \x20 \x20\040 \040\x20\040 \x20\x20 \040\x20\040\x20 \x20\x20\040  \040\040\x20\040\040  \x20\x20\x3c\057\x74\x72>";} }$vattable .= "</t\x61bl\x65\x3e";}else{ $vattable = "";}$this->replacements["\044"."\x56AT\102\x4c\x4f\x43K$"] = $vattable;$this->x12(); if($x26($this->content,"\043V\x41\x54\102\114\117\x43\113_\123TA\x52T\x23") !== false && $x26($this->content,"\043\126\101TBL\117CK\137\x45N\x44\x23") !== false){$this->convertVatBlock();$VExplodedPdf = array();$VExploded = $x12("#V\x41T\x42\x4c\x4f\103\x4b\x5f\123\x54ART\x23",$this->content);$VExplodedPdf[] = $VExploded[0];for($iterator=1;$iterator<$x10($VExploded);$iterator++){$VSubExploded = $x12("\x23V\x41\x54\102\114OC\113\137\x45\116\x44#",$VExploded[$iterator]);foreach($VSubExploded as $Vpart){$VExplodedPdf[] = $Vpart;}$Vhighestpartid = $iterator*2-1;$VProductParts[$Vhighestpartid]=$VExplodedPdf[$Vhighestpartid];$VExplodedPdf[$Vhighestpartid]='';}if ($x10($Products["\x54\x4f\124AL"]["V\101\x54B\114\x4f\103K"]) > 0){foreach ($Products["TO\x54\101L"]["\126\x41\124\102L\x4fCK"] as $keyW=>$valueW){foreach($VProductParts as $productpartid=>$productparttext){if($valueW["\x6e\x65\x74\164\157"]!=0){foreach($valueW as $vColl=>$vVal){if($x19($vVal))$vVal = $this->x1c($vVal);$productparttext = $x21("$"."\126\101TBL\117C\x4b\137".$x25($vColl)."$", $vVal, $productparttext);}$VExplodedPdf[$productpartid].=$productparttext;}}}}$this->content = $x17('',$VExplodedPdf);}}return $Products;}private function x29(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $tacModules = array();$tac4you = $x19(getTabId("T\x61\x63\064\x79\157\x75"));if($tac4you == true) { $tacSql = "\x53\105\114\x45\103\x54 \164\145\170\x74 F\122\x4fM\040\166t\x69\x67\145\x72\x5ft\141c4y\x6fu\137\164\145\170t\163\040WHE\122\x45 i\x64\075\077"; $tacResult = $this->db->pquery($tacSql, array($this->focus->id)); $tacText = $this->db->query_result($tacResult, 0, "t\145\170\x74"); $this->replacements["$"."\163\x2d".$x24($this->module)."_\x74\141c\x34\x79\157\165\044"] = $x15($tacText, ENT_QUOTES, $this->def_charset);;} } private function x2a() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $desc4youModules = array();$desc4you = $x19(getTabId("\x44es\143\162i\160\164io\x6e\163\x34\x79\157\165"));if($desc4you == true) { $descSql = "\123E\x4cE\103\x54 \x74\145\x78t \x46R\x4f\x4d\x20vtig\145r\137des\143ri\160ti\x6fns\064\x79ou_\x74\145\170ts\x20\127\x48\105\122\105\x20\151\144\x3d\077"; $descResult = $this->db->pquery($descSql, array($this->focus->id)); $descText = $this->db->query_result($descResult, 0, "tex\x74"); $this->replacements["$"."\x73-".$x24($this->module)."_des\x63\x34\x79\157\x75\044"] = $x15($descText, ENT_QUOTES, $this->def_charset);;}}private function x2b(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$x27,$x28,$x29; $sql = "\123\105LEC\124\x20\166\x65\162\163\151\157\x6e\137\164\171\160e\054\x20\154\151c\x65n\163e\x5fk\x65y\x20\x46\x52\117\115\x20\166\164\151\147\x65\162\x5f\145m\x61\x6be\x72\x74\x65\x6d\x70\154\x61t\145\163_\154\151c\145\x6e\163e";$result = $this->db->query($sql);if($this->db->num_rows($result) > 0) {$this->version_type = $this->db->query_result($result,0,"\x76\x65r\x73\151\x6f\x6e\137typ\x65");$this->license_key = $this->db->query_result($result,0,"\x6c\x69\143e\x6e\x73e\137ke\x79");}}}

function getEMAILContent($description, $id, $parent_type, $pid = '')
{
    global $adb,$log;

	$token_data_pair = explode('$',$description);
	global $current_user;
 	$emailTemplate = new EmailTemplate($parent_type, $description, $id, $current_user);
 	$description = $emailTemplate->getProcessedDescription();
 	$templateVariablePair = explode('$',$description);
 	$tokenDataPair = explode('$',$description);
	$fields = Array();
	for($i=1;$i < count($token_data_pair);$i+=2)
	{

		$module = explode('-',$tokenDataPair[$i]);
		$fields[$module[0]][] = $module[1];
	}
    if(is_array($fields['custom']) && count($fields['custom']) > 0){
    //Puneeth : Added for custom date & time fields
    $description = getMergedDescriptionCustomVars($fields, $description);
    }
    $log->debug("Exiting from getMergedDescription ...");
	return $description;
}
?>